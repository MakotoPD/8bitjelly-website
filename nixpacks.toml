# 1. Setup
[phases.setup]
# Usuwamy pnpm, zostawiamy nodejs (który zawiera npm) oraz biblioteki systemowe
nixPkgs = ['nodejs_20', 'vips', 'python3', 'gcc', 'gnumake']

# 2. Install
# KROK 1: Usuwamy pnpm-lock.yaml, aby npm nie próbował go interpretować
# KROK 2: Instalujemy zależności przy pomocy npm (to naprawia błąd oxc-parser)
[phases.install]
cmds = ['rm -f pnpm-lock.yaml', 'npm install']

# 3. Build
[phases.build]
cmds = ['npm run build']

# 4. Start
[start]
cmd = 'node .output/server/index.mjs'

[variables]
NUXT_HOST = '0.0.0.0'
NUXT_PORT = '3000'
NODE_ENV = 'production'